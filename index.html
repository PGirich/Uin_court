<style>
  .thumb {
    height: 75px;
    border: 1px solid #000;
    margin: 10px 5px 0 0;
  }

  div {
    margin-bottom: 10px;
    padding-bottom: 10px;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 1px;
  }
  div#border {
    border: 1px dotted red;
    margin: 20px;
  }
  div#outline {
    outline: 1px solid red;
    outline-offset: -2px;
  }
</style>

<div id="outline">
  <p>
    Формирование УИН ФССП России для судебного акта, администрируемого ФССП России, по запросу суда
  </p>
  <p>
    <a
      href="https://fssp.gov.ru/files/fssp/db/files/00smev2022/trebovaniya_k_formirovaniu_uin_v4_20220620_20226271547.pdf"
      >Требования к формированию уникального идентификатора начислений в
      документах ФССП России, предназначенного для идентификации начисления</a
    >, опубликованы на
    <a href="https://fssp.gov.ru/mvv_fssp/">сайте ФССП России</a>. Согласно
    данных требований для формирования УИН достаточно знания регистрационного номера, присвоенного территориальным органом ФССП России - администратором дохода, запроса суда в формате n..n/yy/rr000.</p>
</div>
<div id="outline"><br><b>ВЕРСИЯ ДЛЯ РАБОТНИКОВ ФССП РОССИИ </b>
</div>
<div id="border">
  <p class="name">Укажите регистрационный номер входящего запроса суда о предоставлении УИН для получения УИН, или УИН для получения номера запроса суда</p>
  <label for="editboxNo">Вх.№ запроса: </label>
  <input
    type="text"
    id="editboxNo"
    value="123456/23/24000"
    placeholder="n..n/yy/rr000"
  />
  <>
  <label for="editboxUIN">УИН суд.акта: </label>
  <input
    type="text"
    id="editboxUIN"
    value="32224000230123456119"
    placeholder="322....00 (20 цифр)"
  />
  <br><h5>
  <label id="labelUINType"></label>
</div>

<div id="outline">
<p>
  Порядок действий при получении запроса суда о предоставлении УИН для включения в судебный акт
</p>
<p>
  1. Завести дело по администрированию доходов бюджета с номером, соответствующим регистрационному номеру входящего запроса суда (в формате n..n/yy/rr000-АД), поместить в него запрос суда <br>
  2. С помощью настоящей веб-страницы сформировать УИН и направить его в суд<br>
  3. Обратить внимание на отсутствие в составе запроса судебного акта или информации о нем (письмо СД при ВС РФ от 24.04.2023 № СД-АП/650). Рассматривать отсутствие указанной информации, как отсутствие основания для начисления<br>  
  4. Принять к сведению, что, несмотря на наличие УИН, начисление в ГИС ГМП не будет сформировано (ни ФССП России, ни судом) и на ЕПГУ не появится возможность оплаты по данному УИН<br>
  5. Дождаться предъявления судебного акта на принудиительное исполнение в один из отделов судебных приставов и возбуждения исполнительного производства. Отметить, что АИС ФССП России в день возбуждения или на следующий день автоматически сформирует начисление в ГИС ГМП и на ЕПГУ появится возможность оплаты по данному УИН
</p>
</div>

<div id="outline"><br><b>ВЕРСИЯ ДЛЯ РАБОТНИКОВ СУДА </b>
</div>
<div id="border">
<p class="name">Укажите порядковый номер дела, год регистрации и код суда для получения УИН, или УИН для получения номера дела, года регистрации и кода суда</p>
<label for="editboxActNo">№ дела: </label>
<input
  type="text"
  id="editboxActNo"
  value="1"
  placeholder="n..n"
/>
<button id="buttonGetNo">Получить</button>
<label for="editboxActYr">Год (2 цифры) </label>
<input
  type="text"
  id="editboxActYr"
  value="23"
  placeholder="yy"
/>
<label for="editboxActCo">Код суда: </label>
<input
  type="text"
  id="editboxActCo"
  value="77OS0000"
  placeholder="rrccnnnn"
/>
<><br>
<label for="editboxActUIN">УИН суд.акта: </label>
<input
  type="text"
  id="editboxActUIN"
  value=""
  placeholder="322....00 (20 цифр)"
/>
<br>
</div>

<div id="outline">
<p>
  Порядок действий для получения УИН при изготовлении судебного акта, администрируемого ФССП России, в случае его вынесения не на основании материалов, направленных ФССП России, органами прокуратуры (в материалах в этом случае присутствует УИН и его получение не требуется)
</p>
<p>
  1. Указать год регистрации изготавливаемого акта, код суда (значение имеют первые 2 цифры)<br>
  2. Один раз нажать на кнопку "Получить". При повторных нажатиях будут сформированы новые номер и номерное пространство (1-9999999) может быть исчерпано<br>
  3. Включить полученный УИН в состав изготавливаемого акта<br>  
  4. Принять к сведению, что, несмотря на предоставление УИН, начисление в ГИС ГМП не будет сформировано ФССП России и на ЕПГУ не появится возможность оплаты по данному УИН<br>
  5. При предъявлении судебного акта на принудиительное исполнение в один из отделов судебных приставов и возбуждения исполнительного производства АИС ФССП России в день возбуждения или на следующий день автоматически сформирует начисление в ГИС ГМП и на ЕПГУ появится возможность оплаты по данному УИН
</p>
</div>





<script>
  //===========================
  // Контрольный разряд уникального идентификатора начисления рассчитывается в следующем порядке:
  // каждому разряду уникального идентификатора начисления (первые 19 разрядов для 20-значного либо первые 24 разряда для 25-значного уникального идентификатора начисления), начиная со старшего разряда, присваивается весовой коэффициент, соответствующий повторяющемуся ряду чисел от 1 до 10;
  // рассчитываются произведения значений разрядов на соответствующие весовые коэффициенты и вычисляется сумма полученных произведений;
  // контрольный разряд уникального идентификатора начисления представляет собой остаток от деления полученной суммы на модуль 11 и должен иметь значение от 0 до 9;
  // если полученный остаток равен 10, проводится повторный расчет с применением второй последовательности весовых коэффициентов, являющейся результатом циклического сдвига исходной последовательности на два разряда влево (3, 4, 5, 6, 7, 8, 9, 10, 1, 2);
  // в случае если при повторном расчете остаток от деления вновь сохраняется равным 10, то значение контрольного разряда признается равным нулю ("0").
  //===========================
  // Получить контрольный разряд УИН
  function getControlSum(strUin, startVes) {
    var controlSum = 0;
    for (var i = 0; i < strUin.length; i++) {
      var ves = ((i + startVes - 1) % 10) + 1;
      controlSum += Number(strUin[i]) * ves;
      //spanText = spanText + '<br> ==> ' + strUin[i] + ' -> ' + ves;
    }
    return controlSum % 11;
  }

  //===========================
  // Получить УИН по номеру
  function getUin(lninp) {
    // валидация элементов номера
    const valRegExp = /\d{1,7}\/2\d{1}\/\d{2}000/g
    var validNo = valRegExp.exec(lninp);
    var uin = 'Неверно указан номер регистрационный номер входящего запроса суда'; //+ipno+' '+ipyr+' '+ipdp1+' '+ipdp2 ;
    // Для валидного номера ИП рассчитываем УИН
    if (validNo) {
    // Выделяем фрагменты номера
      var aln = validNo[0].toUpperCase().trim().split('/');
      var docNo = aln[0];
      var docYr = aln[1];
      var docDep = aln[2];
      var uin19 = '322' + docDep + docYr + ('0000000' + docNo).slice(-7) + '11';
      var crc = getControlSum(uin19, 1);
      if (crc == 10) {
        crc = getControlSum(uin19, 3);
        if (crc == 10) {
          crc = 0;
        }
      }
      uin = uin19 + crc;
    }
    return uin;
  }

  //===========================
  // Получить номер запроса по УИН
  function getNo(lninp) {
    // Выделяем фрагменты номера ИП
    no =
      lninp.substring(10, 17).replace(/^0+/, '') +
      '/' +
      lninp.substring(8, 10) +
      '/' +
      lninp.substring(3, 8);
    return no;
  }

  //===========================
  // Отобразить тип УИН
  function detectUINType() {
    let uin = document.getElementById('editboxUIN').value;
    let uinType = uin.substring(17, 19);
    let uinid = uinTypeId.indexOf(uinType);
    document.getElementById('labelUINType').innerHTML = '* Тип УИН: '+ uinTypeName[uinid];
  }

  //===========================
  // Обработка поля ввода
  function handleInputBoxNo(evt) {
    var ln = evt.target.value;
    document.getElementById('editboxUIN').value = getUin(ln);
    detectUINType('editboxUIN');
  }
  function handleInputBoxUIN(evt) {
    var ln = evt.target.value;
    document.getElementById('editboxIP').value = getIP(ln);
    detectUINType();
  }

  function handleInputBoxAct(evt) {
    var ln = 
    document.getElementById('editboxActNo').value+'/'+
    document.getElementById('editboxActYr').value+'/'+
    document.getElementById('editboxActCo').value.substr(0,2)+'000';
    document.getElementById('labelUINType').innerHTML = ln;
    document.getElementById('editboxActUIN').value = getUin(ln);
  }
  function handleInputBoxActUIN(evt) {
    var ln = evt.target.value;
    document.getElementById('editboxActNo').value = ln.substring(10, 17).replace(/^0+/, '');
    document.getElementById('editboxActYr').value = ln.substring(8, 10);
    document.getElementById('editboxActCo').value = ln.substring(3, 5)+'******';
  }

  function handleButtonGetNo(evt) {
    var key =
      document.getElementById('editboxActYr').value+'|'+
      document.getElementById('editboxActCo').value.substr(0,2);
    // тут должен быть код для получения уникального (глобально для всех пользователей в пределах данного ключа) порядкового номера начиная с "1" по данному ключу
    document.getElementById('editboxActNo').value = 0; // уникальный номер
    handleInputBoxAct(evt);
  }



  // тело скрипта

  // определяем массив видов начисление
  const uinTypeId = ['00','01','02','03','04','05','06','07','08','09','10','11'];
  const uinTypeName = [
    'Взыскания по исполнительным производствам',
    'Денежные взыскания Российской Федерации об административных правонарушениях, по делам, подведомственным ФССП России',
    'Возмещение расходов по совершению исполнительских действий, осуществленных Федеральной службой судебных приставов за счет средств федерального бюджета (исполнительские действия в бюджет)','Прочие поступления от денежных взысканий (штрафов) и иных сумм в возмещение ущерба, зачисляемые в федеральный бюджет (материальный ущерб)',
    'Исполнительский сбор',
    'Денежные средства, поступающие от реализации конфискованного имущества/обращения в доход государства',
    'Денежные взыскания (штрафы), установленные УК РФ (уголовные штрафы)',
    'Доходы, поступающие в порядке возмещения федеральному бюджету средств, выплаченных на покрытие процессуальных издержек (процессуальные издержки)',
    'Доходы, поступающие в порядке компенсации затрат на мероприятия, проводимые за счет бюджета (компенсация затрат)',
    'Иные взыскания имущественного характера в пользу бюджетной системы РФ',
    'Денежные взыскания, налагаемые судами (судебные штрафы)',
    'Денежные взыскания (штрафы), установленные Кодексом Российской Федерации об административных правонарушениях, по делам, не подведомственным ФССП России'
  ];

  // установка обработчиков событий
  document
    .getElementById('editboxNo')
    .addEventListener('input', handleInputBoxNo, false);
  document
    .getElementById('editboxUIN')
    .addEventListener('input', handleInputBoxUIN, false);

  document
    .getElementById('editboxActNo')
    .addEventListener('input', handleInputBoxAct, false);
  document.getElementById("editboxActNo").disabled = true;
  document
    .getElementById('editboxActYr')
    .addEventListener('input', handleInputBoxAct, false);
  document
    .getElementById('editboxActCo')
    .addEventListener('input', handleInputBoxAct, false);
  document
    .getElementById('editboxActUIN')
    .addEventListener('input', handleInputBoxActUIN, false);
  document
    .getElementById('buttonGetNo')
    .addEventListener('click', handleButtonGetNo, false);


</script>
